---
title: "Introduction to eaflood"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Introduction to eaflood}
  %\VignetteEncoding{UTF-8}
  %\VignetteEngine{knitr::rmarkdown}
editor_options: 
  chunk_output_type: console
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r setup}
library(eaflood)
library(sf)
library(tmap)
library(tibble)
library(ggplot2)
library(lubridate)
library(dplyr)
```

The `eaflood` package provides access to data from the 
[Environment Agency FloodMonitoring API](https://environment.data.gov.uk/flood-monitoring/doc/reference).

The package also includes functions for plotting the returned data. This 
vignette aims to help you get started using the package to explore flood 
warnings and river data.

# Get flood warnings

The Environment Agency issue warnings of floods that cover specific warning or 
alert areas. The floods API provides a listing of all current such warnings and 
is updated every 15 minutes. Flood warnings can be retrieved with 
`get_flood_warnings()`.


```{r}
flood_warnings <- get_flood_warnings()
flood_warnings
```

You can provide arguments to `get_flood_warnings()` to limit returned warnings 
to a particular county or within a given distance of a particular location. 
See ?get_flood_warnings for more information.

You can also visualise flood warnings in an interactive map.

```{r}
plot_flood_warnings()
```

Note that the flood warnings shown here are as current when this vignette was generated, not those currently active. 

# Flood areas

```{r}
flood_areas <- get_flood_areas(lat = 53.38,
                               lon = -1.46,
                               dist = 10)
```

```{r}
plot_flood_areas(lat = 53.38,
                               lon = -1.46,
                               dist = 10)
```

# Get stations

```{r}
stations <- get_stations(search = "Dronfield")
stations %>% 
  tibble()

get_stations(town = "Leeds")
```

# Get measures

```{r}
measures <- get_measures()
measures %>% 
  tibble()

measures %>% 
  group_by(stationReference) %>% 
  summarise(count = n()) %>% 
  arrange(-count)
```

# Get readings

```{r}
readings <- get_readings(station = "3210TH", latest = TRUE)
readings %>% 
    tibble()

readings %>% 
  ggplot(aes(x = dateTime, value)) + 
  geom_line() + 
  facet_wrap(~measure, ncol = 1, scales = "free_y")
```

```{r}
readings_measure <- get_readings(measure = "L0607-level-stage-i-15_min-m", start_date = ymd("2022-03-01"), end_date = "2022-03-05")

readings_measure %>% 
  ggplot(aes(dateTime, value)) + geom_line()
```

```{r}
plot_measure_readings("L0607-level-stage-i-15_min-m")
```

